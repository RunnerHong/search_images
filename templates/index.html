<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Search Images By One Image</title>
</head>
<body>
    <form action="{{ url_for('search') }}" method="POST" onsubmit="return false;">
        <input type="file" id="SearchImage" name="image_search" multiple>
        <img hidden src="" class="img" />
        <p>Drag your files here or click in this area.</p>
        <button type="submit">Upload</button>
    </form>
</body>
</html>
<style>
    body{
        background: rgba(0,0,0,0.9);
    }
    form{
        position: absolute;
        top: 30%;
        left: 50%;
        margin-top: -100px;
        margin-left: -250px;
        width: 500px;
        height: 200px;
        border: 4px dashed #fff;
    }
    form img{
        width: 500px;
        height: 200px;
        text-align: center;
        line-height: 170px;
        color: #ffffff;
        margin-block-start: 0em;
        margin-block-end: 2em;
        margin-inline-start: 0px;
        margin-inline-end: 0px;
    }
    form p{
        width: 100%;
        height: 100%;
        text-align: center;
        line-height: 170px;
        color: #ffffff;
        font-family: Arial;
    }
    form input{
        position: absolute;
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        outline: none;
        opacity: 0;
    }
    form button{
        margin: 0;
        color: #fff;
        background: #16a085;
        border: none;
        width: 508px;
        height: 35px;
        margin-top: -20px;
        margin-left: -4px;
        border-radius: 4px;
        border-bottom: 4px solid #117A60;
        transition: all .2s ease;
        outline: none;
    }
    form button:hover{
        background: #149174;
            color: #0C5645;
        }
    form button:active{
        border:0;
    }
</style>
<script type="text/javascript" src="http://libs.baidu.com/jquery/1.9.1/jquery.min.js"></script>
<script>
    $(document).ready(function(){
<!--        $('form input').change(function () {-->
<!--            $('form p').text(this.files.length + " file(s) selected");-->
<!--        });-->
        $("#SearchImage").on('change', null, function () {
               var file = this.files[0];//获取文件信息
               if (window.FileReader)
               {
                   var reader = new FileReader();
                   reader.readAsDataURL(file);
                   //监听文件读取结束后事件    
                   reader.onloadend = function (e) {
                       $("form .img").attr("src",e.target.result);
                       $("form .img")[0].removeAttribute('hidden');
                       $('form p')[0].setAttribute("hidden", true);
                   };
               }
        });
        $('form button').on('click', null, function() {
            console.log($('form .img').attr("src"));
            if ($('form .img').attr("src") == null) {
                return;
            }
            var formData = new FormData();
            var url = $("form").attr("action");
            formData.append('image_search', $('form .img').attr("src"));
            $.ajax({
                url: url,
                type: "post",
                data: formData,
                contentType: false,
                processData: false,
                success: function(data) {
                    if (data.type == "success") {
                        alert(data);
                    } else {
                        alert(data.msg);
                    }
                },
                error:function(data) {
                    alert("上传失败")
                }
            });
        });
    });
</script>

